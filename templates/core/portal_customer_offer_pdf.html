<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <style>
    @page {
      size: A4;
      margin: 2cm;
    }
    body { 
      font-family: "DejaVu Sans", sans-serif; 
      font-size: 12px; 
    }
    h1 { font-size: 18px; margin: 0 0 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 6px; }
    th { background: #f2f2f2; text-align: left; }
    td.num { text-align: right; }
    .meta { margin-bottom: 10px; font-size: 11px; color: #555; }
    .total-row td { font-weight: bold; background: #f9f9f9; }
  </style>
</head>
<body>
  <h1>Teklif #{{ ticket.id }} - {{ ticket.title }}</h1>
  <div class="meta">
    Müşteri: {{ ticket.customer.name }}<br/>
    Kategori: {{ ticket.category.name }}<br/>
    Tarih: {{ ticket.created_at|date:"Y-m-d H:i" }}
  </div>
  
  {% if ticket.description %}
  <div class="meta">
    <strong>Açıklama:</strong> {{ ticket.description }}
  </div>
  {% endif %}
  
  {% if extra_fields %}
  <div class="meta">
    <strong>Form Yanıtları:</strong>
    <ul>
      {% for f in extra_fields %}
        <li>{{ f.label }}: {{ f.value }}</li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}
  
  <table>
    <thead>
      <tr>
        <th>Ürün</th>
        <th class="num">Adet</th>
        <th class="num">Birim fiyat</th>
        <th class="num">Toplam</th>
      </tr>
    </thead>
    <tbody>
    {% for it in items %}
      <tr>
        <td>
          {{ it.name }}
          {% if it.description and it.description != it.name %}
            <br/><small style="color: #666;">{{ it.description }}</small>
          {% endif %}
        </td>
        <td class="num">{{ it.quantity }}</td>
        <td class="num">{{ it.sell_unit_price|floatformat:2 }} {{ currency }}</td>
        <td class="num">{{ it.sell_total|floatformat:2 }} {{ currency }}</td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="4">Kalem bulunamadı.</td>
      </tr>
    {% endfor %}
      <tr>
        <td colspan="3" class="num">Ara toplam</td>
        <td class="num">{{ items_subtotal|floatformat:2 }} {{ currency }}</td>
      </tr>
      <tr class="total-row">
        <td colspan="3" class="num">Genel toplam</td>
        <td class="num">{{ grand_total|floatformat:2 }} {{ currency }}</td>
      </tr>
    </tbody>
  </table>
  
  {% if ticket.offered_note %}
  <div class="meta" style="margin-top: 15px;">
    <strong>Not:</strong> {{ ticket.offered_note }}
  </div>
  {% endif %}
</body>
</html>
